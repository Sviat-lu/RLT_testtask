# Проект RLT testtask
Проект - тестовое задание.<br>
Сервис представляет из себя telegram-бота, который выполняет поиск и агрегацию статистических данных о зарплатах сотрудников компании по временным промежуткам на основе коллекции со статистическими данными.

### Принцип агрегации: <br>
- Данные агрегируются по месяцам, неделям или дням в зависимости от входных данных
- Возвращается массив значений зарплат сотрудников компании за указанный период
- Возвращается массив меток времени, соответствующих значениям зарплат

### Принимаемые значения:
- dt_from - начало интервала
- dt_upto - конец интервала
- group_type - тип группировки (поддерживаются варианты: day, week, month)

### Пример входных данных:
```
{
    "dt_from": "2022-09-01T00:00:00", 
    "dt_upto": "2022-12-31T23:59:00", 
    "group_type": "month"
}
```
### Пример возвращаемых данных:
```
{
    "dataset": [5906586, 5515874, 5889803, 6092634], 
    "labels": [
        "2022-09-01T00:00:00", 
        "2022-10-01T00:00:00", 
        "2022-11-01T00:00:00", 
        "2022-12-01T00:00:00"
    ]
}
```


## Запуск бота:
> *Предполагается, что перед запуском проекта у пользователя уже установлены Mongosh и Mongo-db-tools, а так же имеется bot API token*
1. Скопировать репозиторий на локальный компьютер, выполнив команду:

```
git clone https://github.com/lisSobaka/RLT_testtask
```

2. Перейти в директорию проекта:
```
cd RLT_test_task
```
3. Создать новое виртуальное окружене:
```
python -m venv venv
```
4. Активировать виртуальное окружене:
```
.\venv\Scripts\activate
```
5. Установить необходимы зависимости:
```
python -m pip install -r requirements.txt
```
6. Восстановить коллекцию в БД из дампа:
```
mongorestore --db dump sample_collection.bson
```
7. Создать в корневой директории проекта файл .env, в который поместить глобальную переменную, равную API-ключу Вашего бота:
> *bot API token указывается в кавычках*
```
TG_TOKEN = "ВАШ BOT API TOKEN"
```
8. Запустить бота:
```
python main.py
```


## Больше примеров работы бота:
Входные данные:
```
/start
```
Данные на выходе:
```
Hi, %user.firstname%!
```
Входные данные:
```
{
   "dt_from": "2022-02-01T00:00:00",
   "dt_upto": "2022-02-02T00:00:00",
   "group_type": "hour"
}
```
Данные на выходе:
```
{
    "dataset": [
        8177, 8407, 4868,
        7706, 8353, 7143,
        6062, 11800, 4077,
        8820, 4788, 11045,
        13048, 2729, 4038,
        9888, 7490, 11644,
        11232, 12177, 2741,
        5341, 8730, 4718,
        0
    ], 
        "labels": [
            "2022-02-01T00:00:00", "2022-02-01T01:00:00", "2022-02-01T02:00:00",
            "2022-02-01T03:00:00", "2022-02-01T04:00:00", "2022-02-01T05:00:00",
            "2022-02-01T06:00:00", "2022-02-01T07:00:00", "2022-02-01T08:00:00",
            "2022-02-01T09:00:00", "2022-02-01T10:00:00", "2022-02-01T11:00:00",
            "2022-02-01T12:00:00", "2022-02-01T13:00:00", "2022-02-01T14:00:00",
            "2022-02-01T15:00:00", "2022-02-01T16:00:00", "2022-02-01T17:00:00",
            "2022-02-01T18:00:00", "2022-02-01T19:00:00", "2022-02-01T20:00:00",
            "2022-02-01T21:00:00", "2022-02-01T22:00:00", "2022-02-01T23:00:00",
            "2022-02-02T00:00:00"
    ]
}
```
